<transformalize>
  <processes>
    <add name="Class">
      <connections>
        <add name="input" provider="postgresql" port="5432" database="MyDD" user="mydd" password="password" />
        <!--<add name="output" provider="console" header="&lt;Orchard&gt;&lt;Recipe&gt;&lt;Name&gt;Generated by Transformalize&lt;/Name&gt;&lt;Author&gt;dalenewman&lt;/Author&gt;&lt;/Recipe&gt;&lt;Data&gt;" footer="&lt;/Data&gt;&lt;/Orchard&gt;" />-->
        <add name="output" database="TflMyDD" />
      </connections>
      <actions>
        <add action="tfl" mode="*" url="c:\Code\MyDD\mydd\tfl\class_tags.xml" before="true" after="false" />
      </actions>
      <entities>
        <add name="app_class" alias="Class" prefix="class_" version="modified" delete="true">
          <fields>
            <add name="id" type="int32" primary-key="true" />
            <add name="title" length="512" />
            <add name="image" length="255" />
            <add name="description" length="max" />
            <add name="cost" type="decimal" precision="6" scale="2" />
            <add name="instructor_id" type="int32" label="instructor id" />
            <add name="created" type="datetime" />
            <add name="modified" type="datetime" />
          </fields>
          <calculated-fields>
            <add name="title_slug" length="512" t="copy(title).slugify()" />
          </calculated-fields>
        </add>
        <add name="app_person" alias="Instructor" prefix="instructor_" version="modified" >
          <fields>
            <add name="id" type="int32" primary-key="true" />
            <add name="first" length="128" />
            <add name="last" length="128" />
            <add name="avatar" length="200" />
            <add name="bio" length="max" />
            <add name="created" type="datetime" />
            <add name="modified" type="datetime" />
          </fields>
          <calculated-fields>
            <add name="instructor_full_name" length="128" t="join( ,first,last)" />
          </calculated-fields>
        </add>
        <add name="ClassTagsStar" connection="output" alias="ClassTags" version="class_tags_version" delete="true" group="true">
          <fields>
            <add name="TflUpdate" alias="class_tags_version" type="datetime" label="Tfl Update" aggregate="max" />
            <add name="class_tags_class_id" type="int32" label="class tags class id" primary-key="true" aggregate="group" />
            <add name="tag_name" alias="tags" length="128" label="tag name" aggregate="join"/>
          </fields>          
        </add>
      </entities>
      <relationships>
        <add left-entity="Class" left-field="instructor_id" right-entity="Instructor" right-field="instructor_id" />
        <add left-entity="Class" left-field="id" right-entity="ClassTags" right-field="class_tags_class_id" />
      </relationships>
    </add>
  </processes>
</transformalize>